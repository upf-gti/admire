(this.webpackJsonpadmire=this.webpackJsonpadmire||[]).push([[8],{105:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(5),a=n(3),c=n(0),o=n(166),i=n(145),s=n(160),l=n(20),u=(n(106),n(1));function d(e){var t=e.id,n=e.user,d=e.master,f=e.local,b=(e.fref,e.stream),j=e.setLiveCallback,m=e.style,O=Object(c.useContext)(l.a),v=(O.videoRef,Object(r.a)(O.devices,2)),p=v[0],h=(v[1],Object(r.a)(O.settings,2)),g=h[0],x=(h[1],Object(r.a)(O.localStream,2)),y=(x[0],x[1],Object(c.useRef)(null)),_=Object(c.useState)(g&&g.audio&&"None"!==g.audio),N=Object(r.a)(_,2),S=N[0],w=N[1],I=Object(c.useState)(g&&g.video&&"None"!==g.video),k=Object(r.a)(I,2),C=k[0],T=k[1];return Object(c.useEffect)((function(){g&&(w(g.audio&&"None"!==g.audio),T(g.video&&"None"!==g.video))}),[null===g||void 0===g?void 0:g.audio,null===g||void 0===g?void 0:g.video]),Object(c.useEffect)((function(){b&&y&&y.current&&(y.current.srcObject=b)}),[b]),Object(u.jsxs)("div",{className:"Video",style:m,children:[Object(u.jsxs)("div",{className:"stream-status",children:[Object(u.jsx)("i",{className:"bi bi-mic-mute-fill ".concat(S?"":"active")}),Object(u.jsx)("i",{className:"bi bi-camera-video-off-fill ".concat(C?"":"active")})]}),Object(u.jsx)("video",{ref:y,autoPlay:!0,playsInline:!0,muted:f}),Object(u.jsxs)("div",{className:"stream-controls",children:[!f&&!S&&Object(u.jsx)("i",{className:"bi ".concat(S?"bi-volume-up-fill":"bi-volume-mute-fill"),onClick:function(){return b.getAudioTracks().forEach((function(e){e.enabled=!e.enabled,w(e.enabled)}))}}),!f&&n.id===d&&Object(u.jsx)("button",{className:"live-btn",onClick:function(e){j(),e.currentTarget.classList.toggle("active")},children:" Live "})]}),f&&Object(u.jsxs)("div",{className:"footer",style:{zIndex:1e3,textAlign:"center"},children:[Object(u.jsxs)(o.a,{size:"lg",drop:"up",as:i.a,id:"dropdown-button-drop-up",variant:"primary",title:Object(u.jsx)("i",{className:"bi ".concat(C?"bi-camera-video-fill":"bi-camera-video-off-fill")}),toggleLabel:"",onClick:function(){return b.getVideoTracks().forEach((function(e){e.enabled=!e.enabled,T(e.enabled)}))},onSelect:function(e,t){var n=[t.currentTarget,Array.from(t.currentTarget.parentElement.children)],r=n[0];n[1].forEach((function(e){return e.classList.remove("active")})),r.classList.add("active"),a.c.setVideo(r.getAttribute("value"))},children:[(!p||!p.video)&&Object(u.jsx)(s.a.Item,{disabled:!0,eventKey:0,children:"No options available"},0),p&&p.video&&Object.entries(p.video).map((function(e,t){var n=Object(r.a)(e,2),a=n[0];n[1];return Object(u.jsxs)(s.a.Item,{eventKey:t,value:a,children:[" ",a," "]},t)}))]},0),Object(u.jsxs)(o.a,{size:"lg",as:i.a,id:"dropdown-button-drop-up",drop:"up",variant:"primary",title:Object(u.jsx)("i",{className:"bi ".concat(S?"bi-mic-fill":"bi-mic-mute-fill")}),toggleLabel:"",onClick:function(){return b.getAudioTracks().forEach((function(e){e.enabled=!e.enabled,w(e.enabled)}))},onSelect:function(e,t){var n=[t.currentTarget,Array.from(t.currentTarget.parentElement.children)],r=n[0];n[1].forEach((function(e){return e.classList.remove("active")})),r.classList.add("active"),a.c.setVideo(r.getAttribute("value"))},children:[(!p||!p.audio)&&Object(u.jsx)(s.a.Item,{disabled:!0,eventKey:0,children:"No options available"},0),p&&p.audio&&Object.entries(p.audio).map((function(e,t){var n=Object(r.a)(e,2),a=n[0];n[1];return Object(u.jsxs)(s.a.Item,{eventKey:t,value:a,children:[" ",a," "]},t)}))]},1)]})]},t)}},106:function(e,t,n){},117:function(e,t,n){"use strict";n.d(t,"a",(function(){return j}));var r=n(5),a=n(3),c=n(0),o=n(167),i=n(144),s=n(134),l=n(166),u=n(145),d=n(160),f=n(20),b=(n(118),n(1));function j(e){e.id;var t=e.fref,n=e.stream,j=e.local,m=Object(c.useContext)(f.a),O=(m.videoRef,Object(r.a)(m.devices,2)),v=O[0],p=(O[1],Object(r.a)(m.settings,2)),h=(p[0],p[1],Object(r.a)(m.localStream,2)),g=(h[0],h[1],Object(c.useRef)(null)),x=Object(c.useState)(null),y=Object(r.a)(x,2),_=y[0],N=y[1],S=Object(c.useState)(null),w=Object(r.a)(S,2),I=w[0],k=w[1];return Object(c.useEffect)((function(){n&&(g.current.srcObject=n)}),[n]),Object(b.jsx)(o.a,{className:"videostream d-flex justify-content-xs-center",children:Object(b.jsxs)("div",{className:"m-auto align-self-center",children:[Object(b.jsx)(i.a,{children:Object(b.jsx)("video",{ref:null!==t&&void 0!==t?t:g,autoPlay:!0,muted:!0,playsInline:!0})}),j&&Object(b.jsxs)(i.a,{className:"mt-2 justify-content-sm-center",noGutters:!0,children:[Object(b.jsx)(s.a,{xs:"auto",children:Object(b.jsxs)(l.a,{size:"lg",drop:"up",as:u.a,id:"dropdown-button-drop-up",variant:"outline-primary",title:Object(b.jsx)("i",{className:"bi ".concat(I?"bi-camera-video-fill":"bi-camera-video-off-fill")}),toggleLabel:"",onClick:function(){return k(!I)},onSelect:function(e,t){Array.from(t.currentTarget.parentElement.children).forEach((function(e,t,n){return e.classList.remove("active")})),t.currentTarget.classList.add("active"),a.c.setVideo(t.currentTarget.getAttribute("value"))},children:[(!v||!v.video)&&Object(b.jsx)(d.a.Item,{disabled:!0,eventKey:0,children:"No options available"},0),v&&v.video&&Object.entries(v.video).map((function(e,t,n){var a=Object(r.a)(e,2),c=a[0];a[1];return Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)(d.a.Item,{eventKey:t,value:c,children:[" ",c," "]},t)})}))]})}),Object(b.jsx)(s.a,{xs:"auto",children:Object(b.jsxs)(l.a,{size:"lg",as:u.a,id:"dropdown-button-drop-up",drop:"up",variant:"outline-primary",title:Object(b.jsx)("i",{className:"bi ".concat(_?"bi-mic-fill":"bi-mic-mute-fill")}),toggleLabel:"",onClick:function(){return N(!_)},onSelect:function(e,t){Array.from(t.currentTarget.parentElement.children).forEach((function(e,t,n){return e.classList.remove("active")})),t.currentTarget.classList.add("active"),a.c.setAudio(t.currentTarget.getAttribute("value"))},children:[(!v||!v.audio)&&Object(b.jsx)(d.a.Item,{disabled:!0,eventKey:0,children:"No options available"},0),v.audio&&Object.entries(v.audio).map((function(e,t,n){var a=Object(r.a)(e,2),c=a[0];a[1];return Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)(d.a.Item,{eventKey:t,value:c,children:[" ",c," "]},t)})}))]})})]})]})})}},118:function(e,t,n){},141:function(e,t,n){},142:function(e,t,n){},143:function(e,t,n){},173:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return E}));var r=n(36),a=n(26);var c=n(22);function o(e){return function(e){if(Array.isArray(e))return Object(a.a)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Object(c.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var i=n(5),s=n(30),l=n(0),u=n.n(l),d=n(169),f=n(170),b=n(84),j=n(167),m=n(144),O=n(134),v=n(4),p=n(23),h=n(3),g=(n(141),n(85)),x=n(93),y=n(94),_=n(99),N=n(97),S=(n(142),n(1)),w=function(e){Object(_.a)(n,e);var t=Object(N.a)(n);function n(){return Object(x.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"render",value:function(){return Object(S.jsxs)("div",{style:{position:"absolute",left:0,top:0},children:[Object(S.jsx)("div",{id:"stars",style:{animation:"animStar  50s linear infinite"}}),Object(S.jsx)("div",{id:"stars2",style:{animation:"animStar 100s linear infinite"}}),Object(S.jsx)("div",{id:"stars3",style:{animation:"animStar 150s linear infinite"}})]})}}]),n}(u.a.Component),I=n.p+"static/media/astro.5de59584.png";n(143);function k(e){e.title,e.description;return Object(S.jsx)(S.Fragment,{children:Object(S.jsxs)("div",{id:"error-page",children:[Object(S.jsx)(w,{}),Object(S.jsx)("div",{id:"astro-container",children:Object(S.jsx)(g.a,{id:"astro",src:I})}),Object(S.jsxs)(m.a,{xs:12,id:"error-container",children:[Object(S.jsx)(m.a,{md:"auto",id:"title",children:"404 Error:"})," ",Object(S.jsx)(m.a,{id:"subtitle",children:"Page not found"}),Object(S.jsxs)(m.a,{children:[Object(S.jsx)("p",{children:"Don't panic, and make sure to watch your oxygen levels."}),Object(S.jsx)(p.b,{to:"/",style:{paddingLeft:0},children:Object(S.jsx)("div",{className:"btn btn-lg btn-outline-light",children:" Return to safety "})})]})]})]})})}var C=n(105),T=(n(117),n(20)),R=n(21);function E(e){var t=e.user,n=(e.setNavItems,Object(v.f)()),a=Object(l.useContext)(R.a),c=Object(l.useContext)(T.a),u=(c.videoRef,Object(i.a)(c.devices,2)),g=(u[0],u[1],Object(i.a)(c.settings,2)),x=(g[0],g[1],Object(i.a)(c.localStream,2)),y=x[0],_=(x[1],Object(v.g)().roomId),N=Object(l.useState)(0),w=Object(i.a)(N,2),I=w[0],E=w[1],L=Object(l.useState)(0),A=Object(i.a)(L,2),P=(A[0],A[1],Object(l.useState)(null)),K=Object(i.a)(P,2);K[0],K[1];function V(){E(I+1),setTimeout(V,2e3)}var z=Object(l.useRef)(null),F=Object(l.useState)({}),D=Object(i.a)(F,2),G=D[0],J=D[1],H=Object(l.useState)({}),M=Object(i.a)(H,2),B=M[0],U=M[1],q=Object(l.useState)(null),Q=Object(i.a)(q,2),W=Q[0],X=Q[1],Y=Object(l.useState)("local"),Z=Object(i.a)(Y,2),$=(Z[0],Z[1],Object(l.useState)(null)),ee=Object(i.a)($,2),te=ee[0],ne=ee[1];function re(e){var n=e.status,c=e.description;e.userId,e.userType,e.channels;if("error"!==n)if(W){a.success("Joined to room ".concat(_));var i,s=h.b.getStream(),l=[].concat(o(W.guests),[W.master]).filter((function(e,n,r){return e!==t.id})),u=Object(r.a)(l);try{for(u.s();!(i=u.n()).done;){var d=i.value;a.warn("Attempting call to ".concat(d)),h.d.call(d,s)||a.error("call missed to ".concat(d))}}catch(f){u.e(f)}finally{u.f()}}else a.error("No RoomInfo");else a.error("Error onJoinRoom ".concat(c))}function ae(e){var t=e.callId;e.callerId;a.warn("onIncomingCall");var n=h.b.getStream();a.info(n.id),h.d.acceptCall(t,n),E(I+1)}function ce(e){a.success("onCallResponse"),console.log(e)}function oe(e){var t=e.call,n=e.stream,r=t.callId;if(a.success("Call ".concat(r," started")),window.streams=G,G[r]=n,console.log("el stream de adri es:",n.id,"el stream de her es:",y.id),J(Object.assign({},G)),!Object.entries(B).some((function(e){var n=Object(i.a)(e,2),r=n[0];if(n[1]!==t.calleeId)return!1;var a=G[r],c=a.getVideoTracks()[0],o=a.getAudioTracks()[0];return t.replaceLocalVideoTrack(c),t.replaceLocalAudioTrack(o),!0}))){var c=y.getVideoTracks()[0],o=y.getAudioTracks()[0];t.replaceLocalVideoTrack(c),t.replaceLocalAudioTrack(o)}}function ie(e){var t=e.callId;t?(a.warn("Call ".concat(t," hangup")),delete G[t],J(Object.assign({},G))):console.error("No call")}function se(e){var t=e.call;if(t){var n=t.callId;a.warn("Call ".concat(n," closed")),delete G[n],J(Object.assign({},G))}else console.error("No call")}function le(){if(z&&z.current&&te){var e=[te,z.current.value],n=e[1];B[e[0]]=n,U(Object.assign({},B)),h.d.call(n)||a.error("call missed to backend ".concat(t))}else console.error("livestreamref is null")}return Object(l.useEffect)((function(){var e,r,c,i,s,l;return console.log("mount"),h.a.on("join_room_response",re),h.a.on("get_rooms_response",i=function(e){e.id,e.status,e.description;var t=e.roomInfos;X(Object.assign({},t[_]))}),h.a.on("master_left_room",c=function(e){a.warn("Master left"),n.push("/")}),h.a.on("guest_joined_room",e=function(e){a.info("Guest joined"),h.a.getRooms()}),h.a.on("guest_left_room",r=function(e){a.warn("Guest left"),h.a.getRooms()}),h.d.on("incoming_call",ae),h.d.on("call_opened",oe),h.d.on("call_response",ce),h.d.on("call_closed",se),h.d.on("user_hangup",ie),window.addEventListener("unload",s=function(e){h.a.leaveRoom()}),h.a.getRooms(),h.a.on("get_rooms_response",l=function(e){e.id,e.status,e.description;var r=e.roomInfos;if(h.a.off("get_rooms_response",l),W=r[_],X(Object.assign({},r[_])),!r[_])return a.error("No RoomInfo"),void n.push("/");[].concat(o(r[_].guests),[r[_].master]).filter((function(e){return e!==t.id})).length&&h.a.joinRoom(_)}),V(),function(){a.warn("room dismount"),h.a.off("get_rooms_response",i),h.a.off("join_room_response",re),h.a.off("master_left_room",c),h.a.off("guest_joined_room",e),h.a.off("guest_left_room",r),h.d.off("incoming_call",ae),h.d.off("call_opened",oe),h.d.off("call_closed",se),h.d.off("call_response",ce),h.d.off("user_hangup",se),window.removeEventListener("unload",s),Object.keys(h.d.getCalls()).forEach((function(e){return h.d.hangup(e)})),h.a.leaveRoom(),console.log("dismount")}}),[_]),W?Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(s.a,{children:Object(S.jsxs)("title",{children:["AdMiRe: ","".concat("0"!==t.type?"Admin":"User"," ").concat(t.id)]})}),Object(S.jsxs)(d.a,{centered:!0,id:"create-room-modal",show:!!te,onHide:function(){return ne(!1)},"aria-labelledby":"contained-modal-title-vcenter",onKeyDown:function(e){13===e.keyCode&&le()},tabIndex:"0",children:[Object(S.jsx)(d.a.Header,{children:Object(S.jsx)(d.a.Title,{children:" Send Peer to Live "})}),Object(S.jsx)(d.a.Body,{children:Object(S.jsx)(f.a.Group,{className:"mb-2",children:Object(S.jsx)(f.a.Control,{size:"lg",ref:z,placeholder:"enter live Id"})})}),Object(S.jsxs)(d.a.Footer,{className:"text-center",children:[Object(S.jsx)(b.a,{variant:"outline-secondary",onClick:function(){return ne(!1)},children:"Cancel"}),Object(S.jsx)(b.a,{variant:"outline-primary",onClick:le,children:"Proceed!"})]})]}),Object(S.jsxs)(j.a,{id:"room",className:"text-center",fluid:"lg",children:[Object(S.jsxs)("h1",{id:"title",className:"pt-3",children:[Object(S.jsx)(b.a,{as:p.b,to:"/",size:"sm",variant:"outline-light",children:Object(S.jsx)("i",{className:"bi bi-box-arrow-left",style:{position:"relative",top:"-2px",fontSize:"x-large"}})}),"#",_]}),Object(S.jsxs)(m.a,{style:{height:"100%"},children:[G&&Object.entries(G).length>=0&&Object(S.jsx)(O.a,{id:"otherstreams",xs:12,md:"3",style:{},children:Object(S.jsx)(m.a,{xs:12,children:Object.entries(G).map((function(e,n,r){if(!h.d.getCalls()[e[0]])return null;var a=h.d.getCalls()[e[0]],c=a.calleeId,o=a.callerId,i=c===t.id?o:c;return Object(S.jsxs)(O.a,{className:"p-1",children:[" ",Object(S.jsx)(C.a,{user:t,master:W.master,id:i,stream:e[1],playsInline:!0,setLiveCallback:function(){ne(e[0])}},i)]},n)}))})}),Object(S.jsx)(O.a,{id:"mainstream",xs:{order:"last"},sm:{order:"first"},children:Object(S.jsx)("div",{className:"m-auto align-self-center",children:Object(S.jsx)(C.a,{user:t,master:W.master,id:"local",stream:y,local:!0,playsInline:!0},-1)})})]})]})]}):Object(S.jsx)(k,{title:"Room '".concat(_,"' does not exist"),description:"some description"})}},93:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return r}))},94:function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}n.d(t,"a",(function(){return a}))},97:function(e,t,n){"use strict";function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e){return(a="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){return!t||"object"!==a(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=r(e);if(t){var o=r(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return c(this,n)}}n.d(t,"a",(function(){return o}))},99:function(e,t,n){"use strict";function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}n.d(t,"a",(function(){return a}))}}]);
//# sourceMappingURL=8.03049660.chunk.js.map